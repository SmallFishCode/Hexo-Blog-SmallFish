---
title: JS作用域(一)
date: 2022/01/24 17:45
tags: JavaScript
categories: JavaScript
cover: /img/6.jpg
---

# 大厂面试题系列-初识作用域

## 前言：

前端面试必考题-作用域，算是入门级必须掌握的一块知识，JavaScript 中有一个特性叫作用域（Scope）

**scope: 每个 javascript 函数都是一个对象，对象中有些属性是我们可以访问的，但是有些不可以，scope 这个属性就是其中之一，它只能被 javascript 引擎存取**

话不多说，先上一段简短的代码体验一下作用域：

```js
例1.1
function foo () {
    var a = 1
    console.log(a);
}
foo()
console.log(a);
```

看完上面这段代码，请问打印出的 2 个 a 的值是多少呢？都是 1 吗？相信有基础的同学一眼就能看出答案：第一个 a 的值为 1，第二个 a 应该会报错（ a is not defined）。这个时候不知道有没有同学会觉得，a 不是等于 1 吗？为什么会报错呢？这就是作用域了，下面我们就一起来揭秘一下~

## 初识作用域

注：有基础的同学可以直接跳过这一节

### 什么是作用域

小黄书上对作用域的解释是：**作用域是一套设计良好的规则来储存变量，并且之后可以方便的找到这些变量**。刚接触 js 的小白们看不懂也不要紧张，接着往后看，看完还不懂评论区留言我上门一对一辅导哈哈哈~
话不多说，接着上代码：

```js
例1.2
function foo (a) {
    var b = a * 2

    function bar (c) {
        console.log( a,b,c );
    }
    bar( b * 3 )
}

foo(2)

```

在上面的例子中，存在着三个作用域：

1. 整个全局的作用域，在此作用域中只存在 foo 一个标识符。
2. 函数 foo 所创建的作用域，在此作用域中存在 a，bar，b 三个标识符。
3. 函数 bar 所创建的作用域，在此作用域中只存在 c 一个标识符。
   下面上个经典的图来理解例 1.2 当中的作用域：

![作用域.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a83965146064ba48d6249522b7be219~tplv-k3u1fbpfcp-watermark.image?)

不同颜色的气泡代表着不同的作用域，这样看作用域是不是更加显而易见。包括作用域中所存在的各个标识符。**作用域气泡由其对应的作用域代码块写在哪里决定，它们是逐级包含的。后面会讲到不同类型的作用域，现在只要假设每一个函数都会创建一个作用域气泡就好了**。

在此处先介绍一下作用域的两种主要的工作模式：第一种是最为普遍的，被大多数编程语言所采用的**词法作用域**，后面会对词法作用域进行深入的讲解。另外一种叫作**动态作用域**，后面也会略做讲解。

### 作用域的作用是什么？

**作用域是在运行的时候，对某些变量，函数和对象的可访问性**。什么意思呢？我们还是来看一段代码:

```js
例1.3
function foo () {
    var a = 1
}
foo()
console.log(a);     // a is not defined

```

为什么这里打印 a 的值会是 not defined 呢？ 正是因为变量 a 是在函数 foo 中定义的，所以在全局环境下打印变量 a 自然会报错。

所以对于作用域的作用是什么我们可以这样理解：**作用域就是一个独立的地盘，让变量不会外泄、暴露出去**。也就是说**作用域最大的用处就是隔离变量，不同作用域下同名变量不会有冲突。**

## 作用域全家桶

在例 1.2 和 1.3 中我们都提到了全局作用域和函数作用域，那么在这一节中我们将会对‘作用域全家桶’有个深入的了解。

### 全局作用域

什么是全局作用域？简单通俗的来说就是：**定义在全局下的变量或函数都处在全局作用域当中。**

那么什么时候会产生全局作用域呢？话不多说，接着上代码：

（1）定义在全局的变量和函数，就会产生全局作用域。

```js
例2.1
var a = '我是全局变量'      //  定义在全局的变量a
function foo() {     //  定义在全局的函数

    var b = '我在函数里面'   //    定义在函数foo中的变量b
    function bar() {    //  定义在函数foo中的函数

    }

}
```

变量 a 和函数 foo 就处在全局作用域下，而变量 b 和函数 bar 在函数 foo 所产生的的函数作用域当中。

（2）直接赋值的变量

```js
例2.2
function foo() {
    a = 3
    var b = 2
}
foo()   // 执行foo才能执行里面的代码
console.log(a);     // 3
console.log(b);     // b is not defined
```

为什么这里的变量 a 会有值呢？因为变量 a 未声明而是直接赋值，所以会自动放入全局作用域中，而变量 b 就是正常情况下，定义在函数 foo 作用域中的变量在全局下无法访问。

**全局作用域的弊端**

```js
例2.3
var a = 2

var a = 4

console.log(a);
```

如上所示，一旦代码量过于复杂，可能就会存在变量名相同的情况，导致命名冲突。

### 函数作用域

什么是函数作用域呢？简单来说：**函数作用域就是在声明函数的时候，会产生一个作用域，这个作用域就被称为函数作用域**。先上代码：

```js
例2.4
function foo() {
    var a = 2
    bar()
    function bar() {
        var b = 1
        console.log(b);     // 1
        console.log(a);     // 2
    }
    console.log(a);         // 2
}
console.log(a);             // a is not defined
foo()
```

在这段代码中，第一个打印 b 为 1，是因为变量 b 是在函数 bar 的作用域中定义，所以可以正常打印出 b 的值。第二个打印 a 为什么值为 2，这是因为在函数作用域中，**内部的作用域可以访问到外部作用域的变量**，而通过第四个打印 a 的值为 not defined 可以看出来，**从外部是无法访问到函数内部变量的**。

### 块级作用域

ES6 中引入的块级作用域，增加了对变量的可控性，大大的提高了变量使用的灵活性。

那么块级作用域在什么时候产生呢？-块级作用域可通过新增命令 let 和 const 声明，所声明的变量在指定块的作用域外无法被访问。**一个块级作用域可以理解为一对花括号{}之间的区域**。接着上代码：

（1）函数中的块级作用域

```js
例2.5
function foo() {
    let a = 1
    console.log(a);     //  1
}
foo()
console.log(a);         //  a is not defined
```

用 let 声明的变量 a 只在函数 foo 中有定义，而在此块级作用域外则没有定义。

（2）for 循环中的块级作用域

```js
例2.6
for(let i = 0;i < 3;i++) {
    console.log(i);     // 0,1,2
}
console.log(i);         // i is not defined
```

变量 i 只在 for 循环中有定义，因为用 let 声明变量 i 产生了块级作用域，而在 for 循环外面则无法访问到变量 i。

相信很多小伙伴看到例 2.6 的时候会有这么个疑惑：let 声明的变量 i 到底是在括号内的作用域中还是在 for 循环内部的{}中呢？让我们来看一段代码：

```js
例2.7

for(let i = 0;i < 3;i++) {
    let i = 'a'
    console.log(i);     // a,a,a
}
```

没错，循环体打印出了三个 a，**这说明在 for 循环当中，在括号内用 let 声明的变量会产生一个父作用域，而在循环体内会产生一个子作用域，那么为什么例 2.6 可以打印出 1,2,3 呢？这是因为内部作用域可以访问到外部作用域，在这里就是说，子作用域可以访问到父作用域的变量 i**，看到这里相信你一定对块级作用域有个认知了吧。

**注意：不可重复声明变量**

```js
例2.8
var a = 2
let a = 1    //  Identifier 'a' has already been declared

```

在一个作用域中重复声明变量则会报错。

## 作用域收关

看完了上面两节的内容相信大家已经对作用域有个初步的认识了吧，在第三节中，会聊到一些拓展以及作用域之后相关的内容，在后续也会更新发布本系列。

### 作用域相关知识概要

在本文中只谈到了作用域的概念和一些不同的作用域，其实在作用域中还存放着一个叫做**执行上下文**的东西，以及**作用域的查找规则**和**变量提升**等内容，要学习这些内容必须熟练掌握作用域的知识所以在后续会发布相关文章来详细讲解面试系列。

### 作用域产生的作用域链

在此先简单的提到一下由许多作用域产生的作用域链，本系列中将作用域和其他相关内容分开，可以将每个内容的部分更加详细的描述到。

**作用域链：scope 中存储的执行期上下文对象的集合，这个集合成链式连接，我们把这种链式连接叫做作用域链**

觉得作者写的还行的可以动动小手点个赞支持一下哦，也可以关注作者，后续会写一整套面试系列内容~ 本文中存在错误也可以在评论区讨论哦！
