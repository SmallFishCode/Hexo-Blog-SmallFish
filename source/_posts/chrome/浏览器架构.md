---
title: 浏览器架构
date: 2022/12/16 20:57:00
tags: 浏览器
categories: 浏览器
cover: /img/bg7.jpg
---

# 1. 前言

> 本文以 Chrome 的架构为例子来介绍, 即目前的多进程架构时代, 其余见 [浏览器历史]()

目前没有关于如何构建网页浏览器的标准规范，因此一个浏览器的实现方法和另外一个可能完全不同。可以是具有多个线程的一个进程，也可以是几个通过 IPC 进行通信的多个进程

我们以 Chrome 的架构为例子来介绍。顶部是 `浏览器主进程`，负责协调应用程序的其他进程。对于 `渲染进程`，将会有多个并且分配给每个 tab。现在，Chrome 为每个 tab 页创建提供单独的进程，包括 iframe

# 2. 浏览器架构的组成部分

### 1. 架构图

下面两张图为 Chrome 的多进程架构图。在渲染进程下有多个图层，它表示为每个 tab 页运行了多个渲染进程

![2022-12-15-20-23-52_浏览器架构篇(一)](<https://cdn.jsdelivr.net/gh/SmallFishCode/PicGo/2022-12-15-20-23-52_浏览器架构篇(一)>)

![2022-12-16-21-10-42_浏览器架构篇(一)](<https://cdn.jsdelivr.net/gh/SmallFishCode/PicGo/2022-12-16-21-10-42_浏览器架构篇(一)>)

### 2. 组成部分

> 在上图中我们看到，最新的 Chrome 浏览器包括：1 个浏览器（Browser）主进程、1 个 GPU 进程、1 个网络（NetWork）进程、多个渲染进程和多个插件进程。

chrome 架构有一下几个组成部分：

1. `浏览器主进程`：主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。

2. `渲染进程`：核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。

3. `GPU 进程`：其实，Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最后，Chrome 在其多进程架构上也引入了 GPU 进程。

4. `网络进程`：主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，现在成为了一个单独的进程。

5. `插件进程`：主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。

还有更多的进程，比如扩展进程和实用进程。我们点击浏览器右上角的三个点，选择“更多工具” -> "任务管理器"，它列出了当前正在运行的进程和占用的 cpu/内存量。如下：

![2022-12-16-21-11-06_浏览器架构篇(一)](<https://cdn.jsdelivr.net/gh/SmallFishCode/PicGo/2022-12-16-21-11-06_浏览器架构篇(一)>)

![2022-12-16-21-11-18_浏览器架构篇(一)](<https://cdn.jsdelivr.net/gh/SmallFishCode/PicGo/2022-12-16-21-11-18_浏览器架构篇(一)>)

# 3. 浏览器多进程架构及其优缺点

上文我们讲到现有的 Chrome 架构是多进程的，那么为什么设计为多进程架构呢？这种架构带来了什么优点和缺点呢？我们来看看：

### 1. 优点

> 多进程模型提升了浏览器的稳定性、流畅性和安全性

1. 每个 tab 页拥有自己进程，页面无响应之后不会影响其他的 tab，当你打开某个网址崩溃了之后，并不会影响其他网页的正常运行。

2. 当有一个页面在无限加载或者有很多长时间执行的线程，会导致占用大量资源，其他页面会卡顿或崩溃。

3. 为了安全性和沙箱隔离。由于操作系统提供了一种限制进程权限的方法，浏览器可以对一些确定的功能进行精确的沙箱处理。例如，chrome 浏览器严格限制了任意用户输入访问任意文件的进程。

### 2. 缺点

1. 更高的资源占用: 因为每个进程都会包含公共基础结构的副本（如 JavaScript 运行环境），这就意味着浏览器会消耗更多的内存资源。

2. 更复杂的体系架构: 浏览器各模块之间耦合性高、扩展性差等问题，会导致现在的架构已经很难适应新的需求了

# 4. Tips

对于上面这两个问题，Chrome 团队一直在寻求一种弹性方案，既可以解决资源占用高的问题，也可以解决复杂的体系架构的问题, 见文章：[浏览器历史]()
